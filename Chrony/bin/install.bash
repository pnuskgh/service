#!/usr/bin/env bash
### ================================================================================================
###     프로그램 명     : install.bash, Version 0.00.003
###     프로그램 설명   : Chrony 시간 동기화 프로그램을 구성 한다.
###     작성자          : 산사랑 (pnuskgh@gmail.com, www.jopenbusiness.com)
###     작성일          : 2017.03.15 ~ 2018.03.07
### ----[History 관리]------------------------------------------------------------------------------
###     수정자          :
###     수정일          :
###     수정 내용       :
### --- [Copyright] --------------------------------------------------------------------------------
###     Copyright (c) 1995~2018 pnuskgh, 오픈소스 비즈니스 컨설팅
###     All rights reserved.
### ================================================================================================

### ------------------------------------------------------------------------------------------------
###     실행 환경을 설정 한다.
### ------------------------------------------------------------------------------------------------
source ${HOME_SERVICE}/bin/config.bash > /dev/null 2>&1

RELATION_DIR="$(dirname $0)"
WORKING_DIR="$(cd -P ${RELATION_DIR}/.. && pwd)"

### ------------------------------------------------------------------------------------------------
###     Chrony를 설치 한다.
### ------------------------------------------------------------------------------------------------
yum install -y chrony
systemctl enable chronyd.service
systemctl restart chronyd.service

### ------------------------------------------------------------------------------------------------
###     Chrony를 환경을 설정 한다.
### ------------------------------------------------------------------------------------------------
vi /etc/chrony.conf
    server 0.asia.pool.ntp.org
    server 1.asia.pool.ntp.org
    server 2.asia.pool.ntp.org
    server 3.asia.pool.ntp.org
    # allow 192.168.110.0/24                                #--- 내부 사용을 위한 설정

### ------------------------------------------------------------------------------------------------
###     방화벽 설정
### ------------------------------------------------------------------------------------------------
firewall-cmd --add-service=ntp --permanent
firewall-cmd --reload

### ------------------------------------------------------------------------------------------------
###     시간 동기화 여부 확인
### ------------------------------------------------------------------------------------------------
timedatectl status
timedatectl | grep "NTP synchronized"
# timedatectl set-ntp yes

chronyc tracking
chronyc sources

date
# chronyc -a makestep                                       #--- 즉시 동기화

### ================================================================================================

